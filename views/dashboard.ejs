<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Extension - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Dashboard</h1>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <!-- Total Customer Budget -->
            <div class="bg-white p-4 rounded-lg shadow-lg">
                <h2 class="text-lg font-semibold text-gray-700">Total Customer Budget</h2>
                <p class="text-2xl font-bold text-gray-800">$<%= customersData.customers.reduce((sum, cust)=> sum +
                        cust.totalBudget, 0).toFixed(2) %></p>
                <a href="/clients/budget" class="mt-2 inline-block text-blue-600 hover:underline">See Details</a>
            </div>
            <!-- Total Ticket Expense Budget -->
            <div class="bg-white p-4 rounded-lg shadow-lg">
                <h2 class="text-lg font-semibold text-gray-700">Total Ticket Expenses</h2>
                <p class="text-2xl font-bold text-gray-800">$<%= expensesData.ticketExpenses.reduce((sum, exp)=> sum +
                        exp.amount, 0).toFixed(2) %></p>
                <a href="/tickets/expenses" class="mt-2 inline-block text-blue-600 hover:underline">See Details</a>
            </div>
            <!-- Total Lead Expense Budget -->
            <div class="bg-white p-4 rounded-lg shadow-lg">
                <h2 class="text-lg font-semibold text-gray-700">Total Lead Expenses</h2>
                <p class="text-2xl font-bold text-gray-800">$<%= expensesData.leadExpenses.reduce((sum, exp)=> sum +
                        exp.amount, 0).toFixed(2) %></p>
                <a href="/leads/expenses" class="mt-2 inline-block text-blue-600 hover:underline">See Details</a>
            </div>
        </div>

        <a href="/expense-threshold" class="text-blue-600 hover:underline mb-4 inline-block">Manage Expense
            Threshold</a>

        <div class="bg-white p-6 rounded-lg shadow-lg mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Lead Expenses</h2>
            <canvas id="leadExpensesChart" width="400" height="200"></canvas>
            <p class="mt-4 text-gray-600">Total Lead Expenses: $<%= leadsData.leads.reduce((sum, lead)=> sum +
                    lead.totalExpense, 0) %></p>
            <% leadsData.leads.forEach(lead=> { %>
                <a href="/leads/expenses?leadId=<%= lead.leadId %>" class="text-blue-600 hover:underline">
                    <%= lead.name %>: $<%= lead.totalExpense %>
                </a><br>
                <% }) %>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-lg mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Ticket Expenses</h2>
            <canvas id="ticketExpensesChart" width="400" height="200"></canvas>
            <p class="mt-4 text-gray-600">Total Ticket Expenses: $<%= expensesData.ticketExpenses.reduce((sum, exp)=>
                    sum + exp.amount, 0) %></p>
            <% expensesData.ticketExpenses.forEach(exp=> { %>
                <a href="/tickets/expenses?ticketId=<%= exp.ticketId %>" class="text-blue-600 hover:underline">Ticket
                    <%= exp.ticketId %>: $<%= exp.amount %></a><br>
                <% }) %>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Client Budget</h2>
            <canvas id="clientBudgetChart" width="400" height="200"></canvas>
            <p class="mt-4 text-gray-600">Total Budget: $<%= customersData.customers.reduce((sum, cust)=> sum +
                    cust.totalBudget, 0) %></p>
            <% customersData.customers.forEach(customer=> { %>
                <a href="/clients/budget?clientId=<%= customer.customerId %>" class="text-blue-600 hover:underline">
                    <%= customer.name %>: $<%= customer.totalBudget %>
                </a><br>
                <% }) %>
        </div>
    </div>

    <script>
        const leadLabels = <%- JSON.stringify(leadsData.leads.map(lead => lead.name)) %>;
        const leadData = <%- JSON.stringify(leadsData.leads.map(lead => lead.totalExpense)) %>;
        const leadCtx = document.getElementById('leadExpensesChart').getContext('2d');
        new Chart(leadCtx, {
            type: 'bar',
            data: {
                labels: leadLabels,
                datasets: [{ label: 'Lead Expenses ($)', data: leadData, backgroundColor: 'rgba(37, 99, 235, 0.6)', borderColor: 'rgba(37, 99, 235, 1)', borderWidth: 1 }]
            },
            options: { scales: { y: { beginAtZero: true } } }
        });

        const ticketLabels = <%- JSON.stringify(expensesData.ticketExpenses.map(exp => `Ticket ${exp.ticketId}`)) %>;
        const ticketData = <%- JSON.stringify(expensesData.ticketExpenses.map(exp => exp.amount)) %>;
        const ticketCtx = document.getElementById('ticketExpensesChart').getContext('2d');
        new Chart(ticketCtx, {
            type: 'bar',
            data: {
                labels: ticketLabels,
                datasets: [{ label: 'Ticket Expenses ($)', data: ticketData, backgroundColor: 'rgba(75, 192, 192, 0.6)', borderColor: 'rgba(75, 192, 192, 1)', borderWidth: 1 }]
            },
            options: { scales: { y: { beginAtZero: true } } }
        });

        const clientBudgetLabels = <%- JSON.stringify(customersData.customers.map(cust => cust.name)) %>;
        const clientBudgetData = <%- JSON.stringify(customersData.customers.map(cust => cust.totalBudget)) %>;
        const clientCtx = document.getElementById('clientBudgetChart').getContext('2d');
        new Chart(clientCtx, {
            type: 'bar',
            data: {
                labels: clientBudgetLabels,
                datasets: [{ label: 'Client Budget ($)', data: clientBudgetData, backgroundColor: 'rgba(255, 159, 64, 0.6)', borderColor: 'rgba(255, 159, 64, 1)', borderWidth: 1 }]
            },
            options: { scales: { y: { beginAtZero: true } } }
        });
    </script>
</body>

</html>